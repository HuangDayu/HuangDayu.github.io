---
title: 俯瞰微服务
date: 2020-11-24 16:02:41
categories: 
- 研讨技术
layout: post
published: true
password: huangdayu.cn
permalink: /blog/45
---


## 前言

&emsp;&emsp;本文旨在让阅读者对微服务（分布式架构）以及微服务框架`SpringCloud`建立全面的认知。

<!-- more -->

## 为何需要微服务

&emsp;&emsp;当产品的需求越来越多和要求越来越高的时候，传统的单体服务随着代码量和功能的增加，使得业务逻辑变得复杂，新增新的功能也越发困难，遇到需求峰值是，必须横向扩展整体服务，加上紧密耦合的情况下，当出现局部异常时影响会被扩大，最终也使得项目难以维护。

&emsp;&emsp;微服务的出现，显然是为了解决这写问题。微服务将之前的单体服务拆分成多个领域服务，每个服务之间建立通信，每一个服务都可以独立运行，独立对外提供服务。每一个团队负责组织服务的开发与维护，以满足持续集成，快速交付，灵活扩展，弹性伸缩，低耦合度，高度复用的要求。

## 微服务功能架构

<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>mermaid.initialize({startOnLoad:true});</script>

<div class="mermaid">

graph LR
Author(大鱼叔叔)
A{微服务}
B[功能架构]
C[服务注册]
F[服务通信]
D[服务配置]
E[服务治理]
G[服务网关]


A -->|定义|B
B --> C
B --> F
B --> D
B --> E
B --> G


C --> C1[服务注册]
C --> C2[服务发现]
C --> C4[事件通知]

F --> F1[远程调用]
F --> F2[消息中间件]

D --> D1[配置编辑]
D --> D2[配置发布]
D --> D3[配置管理]

D2 --> D21[灰度发布]
D2 --> D22[全量发布]
D2 --> D23[指定发布]

E --> E1[服务运维]
E --> E3[服务查询]
E --> E4[服务保障]
E --> E5[任务调度]
E --> E6[事务处理]
E --> E7[服务监控]

E1 --> E1d[服务部署]
E1 --> E1a[服务测试]
E1 --> E1b[服务上线]
E1 --> E1c[服务下线]

E1a --> E1a1[集成测试 & 全链路测试]
E1a --> E1a2[单元测试]

E1b --> E1b1[金丝雀发布]
E1b --> E1b2[滚动式发布]
E1b --> E1b3[蓝绿发布]
E1b --> E1b4[A/B测试]

E1c --> E1ca[无损下线]
E1c --> E1cb[优雅停机]

E1d --> E1da[自动化]
E1d --> E1db[容器]

E3 --> E31[信息查询]
E3 --> E32[接口查询]

E4 --> E41[熔断重试]
E4 --> E42[限流舱壁]

E5 --> E51[任务编排]
E5 --> E52[存储调度]
E5 --> E53[执行注册]

E6 --> E61[事务协调]
E6 --> E62[事务管理]
E6 --> E63[资源管理]

E7 --> E71[指标监控]
E7 --> E72[日志收集]
E7 --> E73[调用追踪]

G --> G1[服务路由]
G --> G2[负载均衡]
G --> G3[服务权鉴]

G1 --> G1a[过滤]
G1 --> G1b[转发]
G1 --> G1c[重定向] 
G1 --> G1d[拦截] 

G2 --> G2a[轮询]
G2 --> G2b[随机]
G2 --> G2c[一致性哈希]
G2 --> G2d[权重]
G2 --> G2e[最小连接数]

G3 --> G3a[令牌]
G3 --> G3b[会话]
G3 --> G3c[秘钥] 

</div>

## 微服务技术架构

<div class="mermaid">

graph LR
Author(大鱼叔叔)
A{微服务}
B[Spring Cloud 技术架构]
C[服务注册]
H[服务通信]
D[服务配置]
E[服务治理]
G[服务网关]



A -->|实践| B
B --> C
B --> H
B --> D
B --> E
B --> G


C --> C1[Eureka]
C --> C2[Zookeeper]
C --> C3[Consul]
C --> C4[Etcd]
C --> C5[Nacos]
C --> C6[CoreDNS]

H --> H1[RPC]
H --> H2[MQ]

H1 --> H1a[Feign]
H1 --> H1b[gRPC]
H1 --> H1c[Dubbo]
H1 --> H1d[RSocket]

H2 --> H2a[Kafka]
H2 --> H2b[RabbitMQ]
H2 --> H2d[ActiveMQ]

D --> D1[Spring Cloud Config & Bus]
D --> D2[Apollo]
D --> D3[Nacos]
D --> D4[Consul]


E --> E1[服务运维]
E --> E3[服务查询]
E --> E4[服务保障]
E --> E5[任务调度]
E --> E6[事务处理]
E --> E7[服务监控]

E1 --> E1d[服务部署]
E1 --> E1a[服务测试]
E1 --> E1b[服务发布]
E1 --> E1c[服务下线]

E1a --> E1a1[Junit]
E1a --> E1a2[Postman]

E1b --> E1b1[Nepxion Discovery]
E1b --> E1b2[Ribbon]


E1c --> E1c1a[Spring Boot Actuator]
E1c --> E1c1b[Nacos]
E1c --> E1c1c[Shutdown Hook]
E1c --> E1c1d[Spring Boot Graceful]

E1d --> E1da[Docker]
E1d --> E1db[Kubernetes]
E1d --> E1dc[Jenkins & WebHook]
E1d --> E1dd[OpenKruise]

E3 --> E31[Spring Boot Admin]

E4 --> E41[Hystrix]
E4 --> E42[Sentinel]
E4 --> E43[Resilience4j]

E5 --> E51[ElasticJob]
E5 --> E52[Quartz]
E5 --> E53[XXL-JOB]
E5 --> E54[PowerJob]
E5 --> E55[Spring Cloud Task]

E6 --> E61[Seata]
E6 --> E62[TCC-Transaction]
E6 --> E63[Happylifeplat-TCC]

E7 --> E71[指标监控]
E7 --> E72[日志收集]
E7 --> E73[调用追踪]


E71 --> E71a[Turbine & Hystrix]
E71 --> E71b[Spring Boot Admin]
E71 --> E71c[Prometheus & Grafana]

E72 --> E72a[Elasticsearch Logstash Kibana]
E72 --> E72b[Sentry]
E72 --> E72c[Spring Cloud Sleuth]

E73 --> E73a[SkyWalking]
E73 --> E73b[Zipkin]
E73 --> E73c[CAT]

G --> Ga[网关]
G --> Gb[权鉴]
G --> Gc[负载均衡]

Ga --> G1[Spring Cloud Gateway]
Ga --> G2[Kong]
Ga --> G3[ApiSix]
Ga --> G4[Traefik]
Ga --> G5[Ambassador]
Ga --> G6[Tyk]
Ga --> G7[GoKu]
Ga --> G8[Zuul]


Gb --> Gb1[OAuth2]
Gb --> Gb2[Session]
Gb --> Gb3[Cookie] 

Gc --> Gc1[Ribbon]
Gc --> Gc2[Srping cloud Loadbalancer]

</div>

## 总结

&emsp;&emsp;当然，微服务的出现，也带来了一些问题，比如增加研发投入的成本和资源成本，增加整体项目的复杂度，问题的排查，单元测试等也变得越发困难。为了解决问题，不得不引入或开发一些功能组件，有边车模式的，有强侵入式的，有基于注解的，这些组件的引入无疑使得项目愈加复杂。

&emsp;&emsp;所以，有得必有失，在技术日新月异的今天，切莫盲目跟随，结合团队自身条件和产品需求，实用型架构才是好架构。
