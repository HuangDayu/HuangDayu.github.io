---
title: Ajax学习笔记
date: 2018-12-20 21:30:34
category:
- 研讨技术
tags:
- Ajax
permalink: /blog/26
---

# 参数说明

参数| 说明 
---- | ---
async	| 布尔值，表示请求是否异步处理。默认是 true。
beforeSend(xhr)	|发送请求前运行的函数。
cache	|布尔值，表示浏览器是否缓存被请求页面。默认是 true。
complete(xhr,status)	|请求完成时运行的函数（在请求成功或失败之后均调用，即在 success 和 error 函数之后）。
contentType|	发送数据到服务器时所使用的内容类型。默认是：”application/x-www-form-urlencoded”。
context	|为所有 AJAX 相关的回调函数规定 “this” 值。
data	|规定要发送到服务器的数据。
dataFilter(data,type)	|用于处理 XMLHttpRequest 原始响应数据的函数。
dataType|	预期的服务器响应的数据类型。
error(xhr,status,error)	|如果请求失败要运行的函数。
global	|布尔值，规定是否为请求触发全局 AJAX 事件处理程序。默认是 true。
ifModified	|布尔值，规定是否仅在最后一次请求以来响应发生改变时才请求成功。默认是 false。
jsonp	|在一个 jsonp 中重写回调函数的字符串。
jsonpCallback	|在一个 jsonp 中规定回调函数的名称。
password|	规定在 HTTP 访问认证请求中使用的密码。
processData	|布尔值，规定通过请求发送的数据是否转换为查询字符串。默认是 true。
scriptCharset	|规定请求的字符集。
success(result,status,xhr)	|当请求成功时运行的函数。
timeout|	设置本地的请求超时时间（以毫秒计）。
traditional	|布尔值，规定是否使用参数序列化的传统样式。
type	|规定请求的类型（GET 或 POST）。
url	|规定发送请求的 URL。默认是当前页面。
username	|规定在 HTTP 访问认证请求中使用的用户名。
xhr	|用于创建 XMLHttpRequest 对象的函数。

<!-- more -->

# Form的提交

## HTML

```html
<div class="oauth">
  <div class="oauth_logo">
    <img src="/oauth/image/oauth.png"></div>
  <div class="oauth_logo_title">
    <span class="str">授权第三方获取您的
      <span class="str1" onclick="openData()">开放数据</span></span>
    <span th:text="${explain}"></span>
  </div>
  <div class="oauth_login">
    <form id="oauth_from_id" method="POST" name="oauth_from" enctype="application/x-www-form-urlencoded" target="oauthLoginFrame">
      <div class="oauth_login_1">
        <input type="text" required="required" placeholder="请输入登录账号" name="userName" id="username"></input>
      </div>
      <div class="oauth_login_1 oauth_login_2">
        <input type="password" required="required" placeholder="请输入登录密码" name="passWord" id="password"></input>
      </div>
      <div class="oauth_login_button" id="oauth_login_button">
        <button class="oauth_login_button_1" id="oauth_login_button" type="submit" onclick="oauthLogin()">登录并授权</button>
        <div class="oauth_login_button_2">
          <span class="oauth_login_button_2_1">下载APP与注册账户,
            <a href="#" onclick="loadAPP()">点击这里。</a></span>
        </div>
      </div>
    </form>
    <iframe id="oauthLoginFrame" name="oauthLoginFrame" style="display:none"></iframe>
  </div>
</div>
</div>
```

## Ajax提交Form

```javascript
var ajaxFlag;
function oauthLogin2() {
    if (ajaxFlag) {
        return; //终止上一条请求，防止重复请求
    }
    var loginForm = $('#oauth_from_id');
    ajaxFlag = loginForm.submit(function(ev) {
        $.ajax({
            async: false,
            //关闭一步请求
            type: loginForm.attr('method'),
            url: loginForm.attr('action'),
            dataType: "json",
            contentType: loginForm.attr('enctype'),
            data: loginForm.serialize(),
            xhrFields: {
                withCredentials: true
            },
            crossDomain: true,
            //发送请求前运行的函数
            beforeSend: function(xhr) {
                console.log("beforeSend-status：" + xhr.status);
                console.log("beforeSend-state:" + xhr.readyState);
            },
            //当请求成功时运行的函数
            success: function(result, status, xhr) {
                console.log("success-result：" + result);
                console.log("success-status：" + status);
                console.log("success-xhr-status：" + xhr.status);
                console.log("success-xhr-state:" + xhr.readyState);
                var code = result.code;
                var msg = result.msg;
                var des = result.des;
                if (21333 == code) {
                    swal("授权失败", des, "error");
                } else if (21319 == code) {
                    swal("授权成功", des, "success");
                } else {
                    swal("授权失败", "授权发生错误,请稍后重试！", "error");
                }
            },
            //用于处理 XMLHttpRequest 原始响应数据的函数
            dataFilter: function(data, type) {
                console.log("dataFilter-data：" + data);
                console.log("dataFilter-type：" + type);
            },
            //如果请求失败要运行的函数。
            error: function(xhr, status, error) {
                console.log("error-xhr-status：" + xhr.status);
                console.log("error-xhr-state：" + xhr.readyState);
                console.log("error-status:" + status);
                console.log("error-error:" + error);
                var url = xhr.getResponseHeader("location");
                console.log("error-url:" + url);
            },
            //请求完成时运行的函数（在请求成功或失败之后均调用，即在 success 和 error 函数之后）
            complete: function(xhr, status) {
                console.log("complete-xhr-status：" + xhr.status);
                console.log("complete-xhr-state:" + xhr.readyState);
                console.log("complete-status:" + status);
                console.log("complete-url:" + xhr.getResponseHeader("Location"));
                console.log("complete-all-header:" + xhr.getAllResponseHeaders());
                if ((xhr.status >= 300 && xhr.status < 400) && xhr.status != 304) {
                    //重定向网址在响应头中，取出再执行跳转
                    window.location.href = xhr.getResponseHeader('X-Redirect');
                    window.location.href = xhr.getResponseHeader('Location');
                }
            },
        });
        ev.preventDefault();
    });
}
```

## Iframe提交Form

```javascript
function oauthLogin() {
    $('#oauth_login_button').on('click',
    function(XMLHttpRequest, textStatus, errorThrown, event) {
        var timeSet = setInterval(function() {
            try {
                var iframeObj = $(window.frames["oauthLoginFrame"].document);
                var val = iframeObj.find("body").find("pre").html();
                if (val != "" && val.indexOf("code") != -1 && val.indexOf("msg") != -1) {
                    var successData = JSON.parse(val);
                    var code = successData.code;
                    var msg = successData.msg;
                    var des = successData.des;
                    if (21333 == code) {
                        swal("授权失败", des, "error");
                        clearInterval(timeSet);
                        return false;
                    } else {
                        swal("授权成功", "该第三方已可获得您的信息。", "success");
                        clearInterval(timeSet);
                        return true;
                    }
                } else {
                    return false;
                }
            } catch(err) {
                return false;
            }
        },
        1000);
    });
}
```