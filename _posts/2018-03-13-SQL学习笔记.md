---
title: SQL学习笔记
date: 2018-03-13 12:57:46
category: 
- 后端开发
tags:
- MySQL
- 学习笔记
---

# 查询重复数据

```sql
SELECT *
FROM tableName
WHERE user_name IN (
	SELECT user_name
	FROM tableName
	GROUP BY user_name
	HAVING COUNT(user_name) > 1
);
```

<!-- more -->

# 统计数量和占比

```sql
SELECT
	token.client_id AS 'clientId',
	client.client_explain AS 'explain',
	COUNT(token.client_id) AS 'sum',
	CONCAT(
		CONVERT (
			COUNT(token.client_id) * 100 / (
				SELECT
					COUNT(1)
				FROM
					oauth_client_token
			),
			DECIMAL (18, 2)
		),
		'%'
	) AS 'proportion'
FROM
	oauth_client_token AS token
LEFT JOIN oauth_client_client AS client ON client.client_id = token.client_id
GROUP BY
	token.client_id
ORDER BY
	sum DESC;
```

# 删除表B中表A不存在的记录

```sql
DELETE FROM tableB
WHERE NOT EXISTS (
	SELECT 1
	FROM tableA A
	WHERE tableB.did = A.id
);
```

# 数据库事件状态查询

```sql
show variables like '%scheduler%';
```

# 数据库事件开启执行

```sql
SET GLOBAL event_scheduler = 1;
```